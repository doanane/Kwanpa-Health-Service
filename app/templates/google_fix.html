<!DOCTYPE html>
<html>
<head>
    <title>Google OAuth Fix</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        .success { background: #d4edda; padding: 15px; border-radius: 5px; }
        .error { background: #f8d7da; padding: 15px; border-radius: 5px; }
        .info { background: #d1ecf1; padding: 15px; border-radius: 5px; }
        .button { 
            display: inline-block; 
            padding: 12px 24px; 
            background: #4285F4; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px; 
            margin: 10px 5px;
        }
        code { background: #f8f9fa; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Google OAuth Fix</h1>
    
    <div class="info">
        <h3>Current Configuration:</h3>
        <p><strong>Redirect URI:</strong> <code id="redirect-uri">Loading...</code></p>
        <p><strong>Frontend URL:</strong> <code id="frontend-url">Loading...</code></p>
        <p><strong>Backend URL:</strong> <code id="backend-url">Loading...</code></p>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>Test Methods:</h3>
        <p><a href="/auth/google/login" class="button">Method 1: Standard OAuth Flow</a></p>
        <p><a href="/test-google-direct" class="button">Method 2: Direct Google Link</a></p>
        <p><a href="/debug/google-setup" class="button">Method 3: Debug Setup</a></p>
    </div>
    
    <div class="info">
        <h3>Alternative Method (No Redirect URI Issues):</h3>
        <p>Use Google Sign-In button on frontend, then send ID token to:</p>
        <p><code>POST /auth/google/token-auth</code></p>
        <p>This bypasses redirect URI validation completely.</p>
    </div>
    
    <script>
        // Get current URLs
        const currentUrl = window.location.origin;
        document.getElementById('backend-url').textContent = currentUrl;
        
        // Fetch config from backend
        fetch('/auth/google/config')
            .then(response => response.json())
            .then(data => {
                document.getElementById('redirect-uri').textContent = data.redirect_uri || 'Not set';
                document.getElementById('frontend-url').textContent = data.frontend_url || 'Not set';
                
                // Show warning if not configured
                if (!data.configured) {
                    const warning = document.createElement('div');
                    warning.className = 'error';
                    warning.innerHTML = '<h3>Google OAuth Not Configured</h3><p>Set GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET in .env file</p>';
                    document.body.prepend(warning);
                }
            });
        
        // Check for URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        
        if (error) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `<h3>Error: ${error}</h3><p>Check Google Console configuration</p>`;
            document.body.prepend(errorDiv);
        }
    </script>
</body>
</html>